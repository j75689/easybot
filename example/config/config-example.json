{
  "id": "BindAccount",
  "messageType": "TextMessage",
  "messageText": "我的行動借閱證",
  "defaultValues": {
    "bindAcccountUrl": "https://rwdpac.cultural.pthg.gov.tw/"
  },
  "stage": [
    {
      "type": "action",
      "plugin": "curl",
      "paramType": "json",
      "parameter": {
        "url": "https://rwdpac.cultural.pthg.gov.tw/api/graphql",
        "header": [],
        "method": "POST",
        "data": "{\"operationName\":\"getMarcExportList\",\"variables\":{},\"query\":\"query getMarcExportList {\\n  getMarcExportList {\\n    success\\n    message\\n    marcExportList {\\n      id\\n      exporttype\\n      extension\\n      __typename\\n    }\\n    __typename\\n  }\\n}\\n\"}",
        "output": "apiData"
      }
    },
    {
      "type": "action",
      "plugin": "substring",
      "paramType": "json",
      "parameter": {}
    },
    {
      "type": "action",
      "plugin": "equal",
      "paramType": "json",
      "parameter": {
        "target": "true",
        "value": "${binded}"
      },
      "failed": [
        {
          "type": "reply",
          "value": {
            "type": "flex",
            "altText": "Flex Message",
            "contents": {
              "type": "bubble",
              "direction": "ltr",
              "header": {
                "type": "box",
                "layout": "vertical",
                "contents": [
                  {
                    "type": "text",
                    "text": "尚未進行帳戶綁定",
                    "size": "xl",
                    "align": "center",
                    "weight": "bold"
                  }
                ]
              },
              "footer": {
                "type": "box",
                "layout": "horizontal",
                "contents": [
                  {
                    "type": "button",
                    "action": {
                      "type": "uri",
                      "label": "立即綁定",
                      "uri": "${bindAcccountUrl}"
                    }
                  }
                ]
              }
            }
          }
        }
      ]
    },
    {
      "type": "reply",
      "value": {
        "type": "flex",
        "altText": "Flex Message",
        "contents": {
          "type": "bubble",
          "direction": "ltr",
          "header": {},
          "footer": {
            "type": "box",
            "layout": "horizontal",
            "contents": [
              {
                "type": "button",
                "action": {
                  "type": "uri",
                  "label": "檢視借閱證",
                  "uri": "${bindAcccountUrl}"
                }
              }
            ]
          }
        }
      }
    }
  ]
}
